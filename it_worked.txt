
[stack@undercloud tripleo_perf_profile]$ ./tripleo_perf_profile.py hci_enterprise_many_small_vms; cat derived.yaml
# This Heat Environment file generated by tripleo_perf_profiles
# The HCI profile limits Nova resources to avoid taking resources from Ceph
# These derivations are based on load testing HCI to prevent contention
#
# The profile requested was: 'hci_enterprise_many_small_vms'
# - Average guest memory size in GB: 1 
# - Average guest CPU utilization: 20% 
#
# Hardware and Deployment requested: 
# - Total host RAM in GB: 256 
# - Total host cores: 56 
# - Ceph OSDs per host: 12 
#
# Anticipated capacities: 
# - number of guests allowed based on memory = 146 
# - number of guest vCPUs allowed = 220

parameter_defaults:
  ExtraConfig:
    nova::compute::reserved_host_memory: 150528
    nova::cpu_allocation_ratio: 3.9285714285714284
[stack@undercloud tripleo_perf_profile]$ 

OR 

[stack@undercloud tripleo_perf_profile]$ ./tripleo_perf_profile.py hci_enterprise_default; cat derived.yaml
# This Heat Environment file generated by tripleo_perf_profiles
# The HCI profile limits Nova resources to avoid taking resources from Ceph
# These derivations are based on load testing HCI to prevent contention
#
# The profile requested was: 'hci_enterprise_default'
# - Average guest memory size in GB: 2 
# - Average guest CPU utilization: 50% 
#
# Hardware and Deployment requested: 
# - Total host RAM in GB: 256 
# - Total host cores: 56 
# - Ceph OSDs per host: 12 
#
# Anticipated capacities: 
# - number of guests allowed based on memory = 88 
# - number of guest vCPUs allowed = 88

parameter_defaults:
  ExtraConfig:
    nova::compute::reserved_host_memory: 180224
    nova::cpu_allocation_ratio: 1.5714285714285714
[stack@undercloud tripleo_perf_profile]$ 

time openstack overcloud deploy --templates ~/templates \
--libvirt-type qemu \
-r ~/tht/custom-roles.yaml \
-e /home/stack/templates/environments/storage-environment.yaml \
-e ~/tht/ceph.yaml \
-e ~/tht/layout.yaml \
-e ~/tht/derived.yaml


[root@overcloud-osd-compute-0 ~]# grep cpu_allocation_ratio /etc/nova/nova.conf
#cpu_allocation_ratio=0.0
cpu_allocation_ratio=1.5714285714285714
[root@overcloud-osd-compute-0 ~]# grep reserved_host_memory /etc/nova/nova.conf
#reserved_host_memory_mb=512
reserved_host_memory_mb=180224
[root@overcloud-osd-compute-0 ~]# 

